#!/usr/bin/env bash
# Bash script to configure nginx with a 301 redirect for /redirect_me

set -e

# Install nginx if not already installed
apt-get update
apt-get install -y nginx

# Backup default nginx config
cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.bak || true

# Check if /redirect_me already exists, and only add if not present
if ! grep -q "/redirect_me" /etc/nginx/sites-available/default; then
    # Insert redirect block after server_name line
    sed -i '/server_name _;/a \
    location /redirect_me { \
        return 301 https://www.youtube.com/watch?v=QH2-TGUlwu4; \
    }' /etc/nginx/sites-available/default
fi

# Test nginx configuration
nginx -t

# Reload nginx
systemctl reload nginx
