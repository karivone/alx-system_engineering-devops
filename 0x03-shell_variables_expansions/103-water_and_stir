#!/bin/bash

# Define the alphabets (custom base digits)
WATER_BASE="ewatr"
STIR_BASE="ti"
BESTCHOL_BASE="bestchol"

# Convert character to its index in the base
char_to_value() {
    local char="$1"
    local base="$2"
    echo "$base" | awk -v ch="$char" 'BEGIN { split(ch, a, ""); }
    {
        for (i = 1; i <= length($0); i++) {
            if (substr($0, i, 1) == ch) {
                print i - 1
                exit
            }
        }
        print -1
    }'
}

# Convert from custom base to decimal
from_custom_base() {
    local value="$1"
    local base_chars="$2"
    local base_len=${#base_chars}
    local total=0
    local i char val

    for ((i = 0; i < ${#value}; i++)); do
        char="${value:$i:1}"
        val=$(char_to_value "$char" "$base_chars")
        if [[ "$val" -lt 0 ]]; then
            echo "Invalid character $char in base $base_chars" >&2
            echo 0
            return
        fi
        total=$((total * base_len + val))
    done

    echo "$total"
}

# Convert decimal to custom base
to_custom_base() {
    local num=$1
    local base_chars="$2"
    local base_len=${#base_chars}
    local result=""

    if [ "$num" -eq 0 ]; then
        echo "${base_chars:0:1}"
        return
    fi

    while [ "$num" -gt 0 ]; do
        rem=$((num % base_len))
        result="${base_chars:$rem:1}$result"
        num=$((num / base_len))
    done

    echo "$result"
}

# Read environment variables
dec_water=$(from_custom_base "$WATER" "$WATER_BASE")
dec_stir=$(from_custom_base "$STIR" "$STIR_BASE")

# Add them
sum=$((dec_water + dec_stir))

# Convert result to bestchol base
to_custom_base "$sum" "$BESTCHOL_BASE"
